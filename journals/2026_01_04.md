- [[Learn IndexedDB]]
	- 01:08 使用原生方法删除 [[IDB]] 中的数据 #reading
	  id:: 69594cf8-2dc7-4d10-b47b-eedd9c0fcf78
	  collapsed:: true
		- 确保已经[初始化](((6956acae-2332-4bd6-9457-5ea1dc9dedd9))) DB
		- 注意：原生删除数据时不会报错
		  background-color:: yellow
		- ```ts
		  const deleteTodo = (db: IDBDatabase, id: number) => {
		    return new Promise((resolve, reject) => {
		      try {
		        // 1. 开启读写事务
		        const tx = db.transaction(['todos', 'readwrite']);
		        
		        // 2. 获取对象仓库
		        const store = tx.objectStore('todos');
		  
		        // 3. 发起删除请求
		        // 注意：即时 ID 不存在，原生方法也不会报错，而是出发 onsuccess
		        const request = store.delete(id);
		        
		        // 4. 监听成功事件
		        request.onsuccess = () => {
		          console.log(`Item ${id} deleted (or did not exist)`);
		          resolve();
		        };
		        
		        // 5. 监听失败事件
		        request.onerror = () => {
		          console.error(`Delete failed: ${request.error}`);
		          reject(request.error);
		        };
		        
		        // 6. 事务层面的完成
		        tx.complete = () => {
		          // Transaction commited
		        };
		      } catch (error) {
		        reject(error);
		      }
		    });
		  };
		  ```
	- 01:17 使用 [[Dexie.js]] 删除 [[IDB]] 中的数据 #reading
	  id:: 69594f31-ffb5-4a3e-ad66-bc737dadeb63
	  collapsed:: true
		- 确保已[初始化](((6957ad53-105e-4933-8e2f-d0ca281e6b46))) DB
		- ```ts
		  import { db } from './db.ts';
		  
		  const deleteTodo = async (id: number) => {
		    try {
		      // 直接调用 delete 方法
		      await db.todos.delete(id);
		      
		      console.log(`Item ${id} deleted`);
		    } catch (error) {
		      console.error(`Delete failed: ${error}`);
		      throw error;
		    }
		  };
		  ```
	- 21:46 使用原生方法修改 [[IDB]] 中的数据 #reading
	  collapsed:: true
		- 修改 DB 中的数据有两种方式：全量替换 & 局部更新
		- [[IDB]] 中原生修改数据的 `put` 方法直接**覆盖**旧对象，比如原来的数据是：
			- ```json
			  { id: 123, task: "implement some new feature", status: "pending" }
			  ```
			- 如果将 `{ id: 123, status: "doing" }` 传给 `put`，那么 `task` 字段就永久丢失了
			- 因此，安全起见，原生修改数据通常需要：**先读 (get) -> 修改内存对象 -> 再写回 (put)**
		- 下面原生更新 DB 数据的代码需要先[初始化](((6956acae-2332-4bd6-9457-5ea1dc9dedd9)))数据库：
		  collapsed:: true
			- ```ts
			  const updateStatus = (db: IDBDatabase, id: number: newStatus: 'done' | 'pending') => {
			    return new Promise((resolve, reject) => {
			      try {
			        // 1. 开启读写事务
			        const tx = db.transaction(['todos'], 'readwrite');
			        
			        // 2. 获取对象仓库
			        const store = tx.objectStore('todos');
			        
			        // 3. 读取现有数据 (Read First)
			        const getRequest = store.get(id);
			        
			        // 4. 监听读取数据成功事件
			        getRequest.onsuccess = () => {
			          const data = getRequest.result;
			          
			          if (!data) {
			            reject(new Error('Item not found'));
			            return;
			          }
			          
			          // 4.1 在内存中修改数据
			          data.status = newStatus;
			          
			          // 4.2 写回数据库
			          // 注意：put 方法会根据 kayPath (id) 自动找到位置覆盖
			          const putRequest = store.put(data);
			          
			          // 4.3 监听写回数据成功事件
			          putRequest.onsuccess = () => {
			            console.log(`Updated item ${id} to ${newStatus}`);
			            resolve();
			          };
			          
			          // 4.4 监听写回数据失败事件
			          putRequest.onerror = () => reject(putRequest.error);
			        };
			        
			        // 5. 监听读取数据失败事件
			        getRequest.onerror = () => reject(error);
			      } catch (error) {
			        reject(error);
			      }
			    });
			  };
			  ```
	- 22:13 使用 [[Dexie.js]] 修改 [[IDB]] 中的数据 #reading
	  collapsed:: true
		- 和原生修改 DB 数据不同，[[Dexie.js]] 的 `update` 方法只需要关注要更新的字段即可
		- 下面的代码需要事先[初始化](((6957ad53-105e-4933-8e2f-d0ca281e6b46))) DB 数据库
			- ```ts
			  import { db } from './db.ts';
			  
			  const updateStatus = async (id: number, newStatus: 'done' | 'pending') => {
			    try {
			      // 直接调用 update 方法
			      const updatedCount = await db.todos.update(id, { status: newStatus });
			      
			      if (updatedCount === 0) {
			        console.warn(`Item ${id} not found, nothing updated.`);
			      } else {
			        console.log(`Update item ${id} status.`);
			      }
			    } catch (error) {
			      console.error(`Update field: ${error}`);
			      throw error;
			    }
			  };
			  ```
		- [[Dexie.js]] 也提供了类似原生的 `put` 方法，行为和原生 `put` 一致：如果 id 存在则覆盖，不存在则新增